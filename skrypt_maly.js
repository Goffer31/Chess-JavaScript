function getMousePos(e,t){var i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}function getTouchPos(e,t){var i=e.getBoundingClientRect();return{x:t.changedTouches[0].pageX-i.left,y:t.changedTouches[0].pageY-i.top}}function dragPiece(e,t){if(drag){var i=getXPos(e),c=getYPos(t),s=0;for(s=0;32>s&&(getXPos(chessPiece[s].x)!==i||getYPos(chessPiece[s].y)!==c);s++);pieceI=s}else{var h=getXPos(mouseX),g=getYPos(mouseY);if(("White"===chessPiece[pieceI].color&&1===gracz||"Black"===chessPiece[pieceI].color&&2===gracz)&&chessPiece[pieceI].checkIfPossible(h,g)){var a=chessPiece[pieceI].checkForCollission(h,g);if("none"===a[0]&&("Pawn"!==chessPiece[pieceI].type||"Pawn"===chessPiece[pieceI].type&&"straight"===pawnDir))chessPiece[pieceI].x=getX(h),chessPiece[pieceI].y=getY(g),gracz=gracz%2+1,ktoryGracz.innerHTML="Ruch wykonuje gracz nr "+gracz;else if(("different color"===a[0]&&"Pawn"!==chessPiece[pieceI].type||"different color"===a[0]&&"Pawn"===chessPiece[pieceI].type&&"hit"===pawnDir)&&("White"===chessPiece[a[1]].color?(chessPiece[a[1]].x=getX(xPlayer1++),chessPiece[a[1]].y=getY(7)):(chessPiece[a[1]].x=getX(xPlayer2++),chessPiece[a[1]].y=getY(0)),chessPiece[pieceI].x=getX(h),chessPiece[pieceI].y=getY(g),gracz=gracz%2+1,ktoryGracz.innerHTML="Ruch wykonuje gracz nr "+gracz,"King"===chessPiece[a[1]].type)){var r=document.getElementById("ktoryGracz");r.innerHTML="Koniec gry, wygraÅ‚ gracz "+(gracz%2+1),gracz=10}drawChessBoard()}}}function getXPos(e){var t;for(t=0;8>t&&!(width*scale*(t+1)>e);t++);return t}function getYPos(e){var t;for(t=0;8>t&&!(height*scale*(t+1)>e);t++);return t}function getX(e){return e*width*scale}function getY(e){return e*height*scale}function drawRook(e,t,i){"white"==e?ctx.drawImage(img,0,0,width,height,getX(t),getY(i),width*scale,height*scale):ctx.drawImage(img,3*width,0,width,height,getX(t),getY(i),width*scale,height*scale)}function drawKnight(e,t,i){"white"==e?ctx.drawImage(img,0,height,width,height,getX(t),getY(i),width*scale,height*scale):ctx.drawImage(img,3*width,height,width,height,getX(t),getY(i),width*scale,height*scale)}function drawQueen(e,t,i){"white"==e?ctx.drawImage(img,width,0,width,height,getX(t),getY(i),width*scale,height*scale):ctx.drawImage(img,4*width,0,width,height,getX(t),getY(i),width*scale,height*scale)}function drawKing(e,t,i){"white"==e?ctx.drawImage(img,width,height,width,height,getX(t),getY(i),width*scale,height*scale):ctx.drawImage(img,4*width,height,width,height,getX(t),getY(i),width*scale,height*scale)}function drawPawn(e,t,i){"white"==e?ctx.drawImage(img,2*width,0,width,height,getX(t),getY(i),width*scale,height*scale):ctx.drawImage(img,5*width,0,width,height,getX(t),getY(i),width*scale,height*scale)}function drawBishop(e,t,i){"white"==e?ctx.drawImage(img,2*width,height,width,height,getX(t),getY(i),width*scale,height*scale):ctx.drawImage(img,5*width,height,width,height,getX(t),getY(i),width*scale,height*scale)}function drawPiece(e,t,i,c){i.toLowerCase()==="Rook".toLowerCase()&&("white"==c.toLowerCase()?ctx.drawImage(img,0,0,width,height,e,t,width*scale,height*scale):ctx.drawImage(img,3*width,0,width,height,e,t,width*scale,height*scale)),i.toLowerCase()==="Knight".toLowerCase()&&("white"==c.toLowerCase()?ctx.drawImage(img,0,height,width,height,e,t,width*scale,height*scale):ctx.drawImage(img,3*width,height,width,height,e,t,width*scale,height*scale)),i.toLowerCase()==="Queen".toLowerCase()&&("white"==c.toLowerCase()?ctx.drawImage(img,width,0,width,height,e,t,width*scale,height*scale):ctx.drawImage(img,4*width,0,width,height,e,t,width*scale,height*scale)),i.toLowerCase()==="King".toLowerCase()&&("white"==c.toLowerCase()?ctx.drawImage(img,width,height,width,height,e,t,width*scale,height*scale):ctx.drawImage(img,4*width,height,width,height,e,t,width*scale,height*scale)),i.toLowerCase()==="Pawn".toLowerCase()&&("white"==c.toLowerCase()?ctx.drawImage(img,2*width,0,width,height,e,t,width*scale,height*scale):ctx.drawImage(img,5*width,0,width,height,e,t,width*scale,height*scale)),i.toLowerCase()==="Bishop".toLowerCase()&&("white"==c.toLowerCase()?ctx.drawImage(img,2*width,height,width,height,e,t,width*scale,height*scale):ctx.drawImage(img,5*width,height,width,height,e,t,width*scale,height*scale))}function drawChessBoard(){for(var e=0;8>e;e++)for(var t=0;8>t;t++){var i=e*width*scale,c=t*height*scale;(e+t)%2?ctx.fillStyle="#444444":ctx.fillStyle="#FFFFFF",ctx.fillRect(i,c,width*scale,height*scale)}for(var s=0;s<chessPiece.length;s++)chessPiece[s].drawPiece()}function Piece(e,t,i,c,s){this.i=s,this.x=e,this.y=t,this.type=i,this.color=c,this.drawPiece=function(){drawPiece(this.x,this.y,this.type,this.color)},this.checkIfPossible=function(e,t){var i,c=getXPos(this.x),h=getYPos(this.y);if(i="Black"===this.color?1:-1,"Pawn"===this.type)return c===e&&h===t-i?(pawnDir="straight",!0):c!==e-1&&c!==e+1||h!==t-i?(pawnDir="",!1):(pawnDir="hit",!0);if("Knight"===this.type)return c-e!==2&&c-e!==-2||h-t!==1&&h-t!==-1?!(c-e!==1&&c-e!==-1||h-t!==2&&h-t!==-2):!0;if("Rook"===this.type){if(c===e){for(var g=h-t,a=1;g>a;a++)for(s=0;32>s;s++)if(getXPos(chessPiece[s].x)===c&&getYPos(chessPiece[s].y)===h-a)return!1;for(var a=-1;a>g;a--)for(s=0;32>s;s++)if(getXPos(chessPiece[s].x)===c&&getYPos(chessPiece[s].y)===h-a)return!1;return!0}if(h===t){for(var g=c-e,a=1;g>a;a++)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h&&getXPos(chessPiece[s].x)===c-a)return!1;for(var a=-1;a>g;a--)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h&&getXPos(chessPiece[s].x)===c-a)return!1;return!0}}if("Bishop"===this.type){var g=c-e;if(c-e===h-t){for(var a=1;g>a;a++)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h-a&&getXPos(chessPiece[s].x)===c-a)return!1;for(var a=-1;a>g;a--)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h-a&&getXPos(chessPiece[s].x)===c-a)return!1;return!0}if(c-e===t-h){for(var g=c-e,a=1;g>a;a++)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h-a&&getXPos(chessPiece[s].x)===c-a)return!1;for(var a=-1;a>g;a--)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h-a&&getXPos(chessPiece[s].x)===c-a)return!1;return!0}return!1}if("Queen"===this.type){if(c===e){for(var g=h-t,a=1;g>a;a++)for(s=0;32>s;s++)if(getXPos(chessPiece[s].x)===c&&getYPos(chessPiece[s].y)===h-a)return!1;for(var a=-1;a>g;a--)for(s=0;32>s;s++)if(getXPos(chessPiece[s].x)===c&&getYPos(chessPiece[s].y)===h-a)return!1;return!0}if(h===t){for(var g=c-e,a=1;g>a;a++)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h&&getXPos(chessPiece[s].x)===c-a)return!1;for(var a=-1;a>g;a--)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h&&getXPos(chessPiece[s].x)===c-a)return!1;return!0}if(c-e===h-t){for(var g=c-e,a=1;g>a;a++)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h-a&&getXPos(chessPiece[s].x)===c-a)return!1;for(var a=-1;a>g;a--)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h-a&&getXPos(chessPiece[s].x)===c-a)return!1;return!0}if(c-e===t-h){for(var g=c-e,a=1;g>a;a++)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h+a&&getXPos(chessPiece[s].x)===c+a)return!1;for(var a=-1;a>g;a--)for(s=0;32>s;s++)if(getYPos(chessPiece[s].y)===h+a&&getXPos(chessPiece[s].x)===c+a)return!1;return!0}return!1}return"King"===this.type&&c-e>=-1&&1>=c-e&&h-t>=-1&&1>=h-t?c-e===h-t||c-e===-(h-t)?!0:c===e||h===t:void 0},this.checkForCollission=function(e,t){for(s=0;32>=s;s++)if(this.i!==s){if(32>s&&getXPos(chessPiece[s].x)===e&&getYPos(chessPiece[s].y)===t)return chessPiece[s].color===this.color?["same color",s]:["different color",s];if(32===s)return["none"]}}}function generatePieces(){chessPiece[0]=new Piece(getX(0),getY(6),"Pawn","White",0),chessPiece[1]=new Piece(getX(1),getY(6),"Pawn","White",1),chessPiece[2]=new Piece(getX(2),getY(6),"Pawn","White",2),chessPiece[3]=new Piece(getX(3),getY(6),"Pawn","White",3),chessPiece[4]=new Piece(getX(4),getY(6),"Pawn","White",4),chessPiece[5]=new Piece(getX(5),getY(6),"Pawn","White",5),chessPiece[6]=new Piece(getX(6),getY(6),"Pawn","White",6),chessPiece[7]=new Piece(getX(7),getY(6),"Pawn","White",7),chessPiece[8]=new Piece(getX(0),getY(1),"Pawn","Black",8),chessPiece[9]=new Piece(getX(1),getY(1),"Pawn","Black",9),chessPiece[10]=new Piece(getX(2),getY(1),"Pawn","Black",10),chessPiece[11]=new Piece(getX(3),getY(1),"Pawn","Black",11),chessPiece[12]=new Piece(getX(4),getY(1),"Pawn","Black",12),chessPiece[13]=new Piece(getX(5),getY(1),"Pawn","Black",13),chessPiece[14]=new Piece(getX(6),getY(1),"Pawn","Black",14),chessPiece[15]=new Piece(getX(7),getY(1),"Pawn","Black",15),chessPiece[16]=new Piece(getX(0),getY(7),"Rook","White",16),chessPiece[17]=new Piece(getX(7),getY(7),"Rook","White",17),chessPiece[18]=new Piece(getX(0),getY(0),"Rook","Black",18),chessPiece[19]=new Piece(getX(7),getY(0),"Rook","Black",19),chessPiece[20]=new Piece(getX(1),getY(7),"Knight","White",20),chessPiece[21]=new Piece(getX(6),getY(7),"Knight","White",21),chessPiece[22]=new Piece(getX(1),getY(0),"Knight","Black",22),chessPiece[23]=new Piece(getX(6),getY(0),"Knight","Black",23),chessPiece[24]=new Piece(getX(2),getY(7),"Bishop","White",24),chessPiece[25]=new Piece(getX(5),getY(7),"Bishop","White",25),chessPiece[26]=new Piece(getX(2),getY(0),"Bishop","Black",26),chessPiece[27]=new Piece(getX(5),getY(0),"Bishop","Black",27),chessPiece[28]=new Piece(getX(3),getY(7),"Queen","White",28),chessPiece[29]=new Piece(getX(3),getY(0),"Queen","Black",29),chessPiece[30]=new Piece(getX(4),getY(7),"King","White",30),chessPiece[31]=new Piece(getX(4),getY(0),"King","Black",31)}function wykonaj(){document.getElementById("btn_rozpocznij").hidden="hidden",ktoryGracz.innerHTML="Ruch wykonuje gracz nr "+gracz,canvas.addEventListener("mousedown",function(e){var t=getMousePos(canvas,e);"Mouse position: "+t.x+","+t.y;drag=!0,dragPiece(t.x,t.y)},!1),canvas.addEventListener("touchstart",function(e){e.preventDefault();var t=getTouchPos(canvas,e);startX=t.x,startY=t.y;"Mouse position: "+t.x+","+t.y;drag=!0,dragPiece(t.x,t.y)},!1),canvas.addEventListener("mouseup",function(e){var t=getMousePos(canvas,e);"Mouse position: "+t.x+","+t.y;drag=!1,dragPiece()},!1),canvas.addEventListener("touchend",function(e){e.preventDefault();var t=getTouchPos(canvas,e);"Mouse position: "+t.x+","+t.y;drag=!1,dragPiece()},!1),canvas.addEventListener("mousemove",function(e){var t=getMousePos(canvas,e);mouseX=t.x,mouseY=t.y},!1),canvas.addEventListener("touchmove",function(e){e.preventDefault();var t=getTouchPos(canvas,e);mouseX=t.x,mouseY=t.y},!1),generatePieces(),drawChessBoard()}var startX,startY,pawnDir="",gracz=1,drag=!1,width=80,height=81,scale=.5,chessPiece=[{}],ktoryGracz=document.getElementById("ktoryGracz"),canvas=document.getElementById("szachownica");canvas.width=400,canvas.height=400;var ctx=canvas.getContext("2d"),mouseX,mouseY,pieceI,xPlayer1=8,xPlayer2=8;